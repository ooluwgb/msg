#!/usr/bin/env python3
"""
Init Module for the 'msg' command-line tool
Handles initialization functionality including configuration validation and translation setup.
"""

import os
import sys
import subprocess


# --- Color Codes ---
class Colors:
    GREEN = '\033[92m'
    CYAN = '\033[96m'
    YELLOW = '\033[93m'
    RED = '\033[91m'
    RESET = '\033[0m'
    BOLD = '\033[1m'


def print_step(message: str) -> None:
    """Prints a stylized step header."""
    print(f"\n{Colors.BOLD}==> {message}{Colors.RESET}")


def print_success(message: str) -> None:
    """Prints a success message."""
    print(f"{Colors.GREEN}✅ {message}{Colors.RESET}")


def print_info(message: str) -> None:
    """Prints an info message."""
    print(f"{Colors.CYAN}ℹ️  {message}{Colors.RESET}")


def print_error(message: str) -> None:
    """Prints an error message."""
    print(f"{Colors.RED}❌ {message}{Colors.RESET}")


def run_validation():
    """Runs the validation script."""
    script_dir = os.path.dirname(os.path.abspath(__file__))
    validation_script = os.path.join(script_dir, "validation")
    
    if not os.path.exists(validation_script):
        print_error(f"Validation script not found: {validation_script}")
        return False
    
    print_info("Starting validation process...")
    
    try:
        result = subprocess.run(
            [validation_script],
            capture_output=True,
            text=True,
            check=True
        )
        
        # Print the validation output
        if result.stdout:
            print(result.stdout)
        
        print_success("Validation completed successfully!")
        return True
        
    except subprocess.CalledProcessError as e:
        print_error(f"Validation failed with exit code: {e.returncode}")
        if e.stdout:
            print(f"STDOUT: {e.stdout}")
        if e.stderr:
            print(f"STDERR: {e.stderr}")
        return False
    except Exception as e:
        print_error(f"Error running validation: {str(e)}")
        return False


def main():
    """Main initialization function."""
    print("\n" + "="*60)
    print("  MSG INITIALIZATION")
    print("="*60)
    
    print_step("Running system initialization")
    
    # Run validation which will call translator
    if run_validation():
        print_step("Initialization Summary")
        print_success("System initialized successfully!")
        print_info("All components validated and ready for use")
        print()
        print(f"{Colors.CYAN}You can now use 'msg' commands to manage your messages.{Colors.RESET}")
        print(f"{Colors.CYAN}Use 'msg help' to see available commands.{Colors.RESET}")
    else:
        print_step("Initialization Failed")
        print_error("System initialization encountered errors")
        print_info("Please check the error messages above")
        print_info("You may need to run 'msg upgrade' or contact support")
        sys.exit(1)
    
    print("="*60 + "\n")


if __name__ == "__main__":
    main()